(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const D=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),U=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:s,userId:r})=>{const n=D(),a=n.querySelector(".card__like-button"),i=n.querySelector(".card__like-count"),l=n.querySelector(".card__control-button_type_delete"),p=n.querySelector(".card__image");return e.likes.length>0&&(i.textContent=e.likes.length),p.src=e.link,p.alt=e.name,n.querySelector(".card__title").textContent=e.name,e.owner._id!==r&&l.remove(),o&&a.addEventListener("click",()=>{o(e._id,a,i)}),s&&l&&l.addEventListener("click",()=>{s(e._id,n)}),t&&p.addEventListener("click",()=>t({name:e.name,link:e.link})),n},w=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",w)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",w)},W=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})};function j(e,t,o,s){const r=e.querySelector(`#${t.id}-error`);t.classList.add(s.inputErrorClass),r.textContent=o,r.classList.add(s.errorClass)}function H(e,t,o){const s=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),s.textContent="",s.classList.remove(o.errorClass)}function J(e,t,o){if(t.validity.valid)H(e,t,o);else{const s=t.validity.patternMismatch?t.dataset.errorMessage:t.validationMessage;j(e,t,s,o)}}function V(e){return e.some(t=>!t.validity.valid)}function z(e,t){e.setAttribute("disabled",!0),e.classList.add(t.inactiveButtonClass)}function K(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}function R(e,t,o){V(e)?z(t,o):K(t,o)}function G(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);o.forEach(r=>{r.addEventListener("input",()=>{J(e,r,t),R(o,s,t)})})}function Q(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{G(o,e)})}const c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"29f9486e-9abe-4255-a55d-e04db85f4727","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),X=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),M=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),Y=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),Z=({avatar:e})=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),ee=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),te=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u),oe=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(o=>u(o)),T=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),v=S.querySelector(".popup__form"),$=v.querySelector(".popup__input_type_name"),B=v.querySelector(".popup__input_type_description"),b=document.querySelector(".popup_type_new-card"),h=b.querySelector(".popup__form"),re=h.querySelector(".popup__input_type_card-name"),ne=h.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_image"),x=L.querySelector(".popup__image"),se=L.querySelector(".popup__caption"),ce=document.querySelector(".profile__edit-button"),ie=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_edit-avatar"),E=k.querySelector(".popup__form"),le=E.querySelector(".popup__input"),I=document.querySelector(".popup_type_info"),A=I.querySelector(".popup__info"),P=I.querySelector(".popup__list"),ae=document.querySelector(".logo"),ue=document.querySelector("#popup-info-definition-template").content,pe=document.querySelector("#popup-info-user-preview-template").content;let y;const F=({name:e,link:t})=>{x.src=t,x.alt=e,se.textContent=e,m(L)},_=(e,t,o)=>{e.textContent=t?"Сохранение...":o},de=(e,t,o)=>{e.textContent="Создание..."},me=e=>{e.preventDefault(),_(e.submitter,!0),Y({name:$.value,about:B.value}).then(t=>{g.textContent=t.name,C.textContent=t.about,d(S)}).catch(t=>{console.log(t)}).finally(()=>{_(e.submitter,!1,"Сохранить")})},fe=e=>{e.preventDefault(),_(e.submitter,!0),Z({avatar:le.value}).then(t=>{q.style.backgroundImage=`url(${t.avatar})`,d(k)}).catch(t=>{console.log(t)}).finally(()=>{_(e.submitter,!1,"Сохранить")})},_e=e=>{e.preventDefault(),de(e.submitter),ee({name:re.value,link:ne.value}).then(t=>{T.prepend(U(t,{onPreviewPicture:F,onLikeIcon:N,onDeleteCard:O,userId:y})),d(b)}).catch(t=>{console.log(t)}).finally(()=>{e.submitter.textContent="Создать"})},f=(e,t)=>{const o=ue.cloneNode(!0);o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,A.append(o)},he=()=>{A.innerHTML="",P.innerHTML="",M().then(e=>{const t={};e.forEach(i=>{t[i.owner._id]=i.owner.name});const o=Object.keys(t).length;let s=0,r=0,n="";e.forEach(i=>{const l=i.likes.length;s+=l,l>r&&(r=l,n=i.owner.name)}),f("Всего пользователей:",o),f("Всего лайков:",s),f("Максимально лайков от одного:",r),f("Чемпион лайков:",n||"—"),[...e].sort((i,l)=>l.likes.length-i.likes.length).slice(0,3).forEach(i=>{const p=pe.cloneNode(!0).querySelector("li");p.textContent=i.name,P.append(p)}),m(I)}).catch(console.log)};v.addEventListener("submit",me);h.addEventListener("submit",_e);E.addEventListener("submit",fe);ae.addEventListener("click",he);ce.addEventListener("click",()=>{$.value=g.textContent,B.value=C.textContent,m(S)});q.addEventListener("click",()=>{E.reset(),m(k)});ie.addEventListener("click",()=>{h.reset(),m(b)});const O=(e,t)=>{te(e).then(()=>{t.remove()}).catch(o=>{console.log(o)})},N=(e,t,o)=>{const s=t.classList.contains("card__like-button_is-active");oe(e,s).then(r=>{t.classList.toggle("card__like-button_is-active"),o.textContent=r.likes.length}).catch(r=>{console.log(r)})},ye=document.querySelectorAll(".popup");ye.forEach(e=>{W(e)});const Se={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Q(Se);Promise.all([M(),X()]).then(([e,t])=>{y=t._id,g.textContent=t.name,C.textContent=t.about,q.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{T.append(U(o,{onPreviewPicture:F,onLikeIcon:N,onDeleteCard:O,userId:y}))})}).catch(e=>{console.log(e)});
